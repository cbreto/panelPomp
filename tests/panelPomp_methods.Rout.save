> library(panelPomp,quietly=TRUE)
> 
> TESTS_PASS <- NULL
> test <- function(expr1,expr2,all="TESTS_PASS",env=parent.frame(),...) 
+   panelPomp:::test(expr1,expr2,all=all,env=env,...)
> 
> ppo <- pompExample(prw,envir=NULL)[[1]]
> pP2 <- list(shared=c(sigmaX=1,sigmaY=2),
+             specific=matrix(c(0,0.1),nr=1,
+                             dimnames=list(param="X.0",unit=c("rw1","rw2"))))
> ppo <- panelPomp(unitobjects(ppo),params=pP2)
> 
> ## test coef,panelPomp-method
> test(coef(ppo),setNames(c(1,2,0,0.1),c("sigmaX","sigmaY",
+                                        sprintf("X.0[rw1]"),sprintf("X.0[rw2]"))))
[1] TRUE
> ## coef<-,panelPomp-method
> test(coef(ppo),{coef(ppo) <- coef(ppo);coef(ppo)})
[1] TRUE
> wQuotes("Error : in ''coef<-'': part of ''value'' is not part of ",
+                "''coef(object)''.\n") -> err
> test(coef(ppo) <- c(ppo@pParams$shared,xsh=5),err)
[1] TRUE
> test(coef(ppo) <- c(coef(ppo),xsh=5),err)
[1] TRUE
> test({coef(ppo) <- setNames(
+   c(coef(ppo),5,6),c(names(coef(ppo)),
+                      sprintf("xsp[rw1]"),sprintf("xsp[rw2]")))},err)
[1] TRUE
> test({coef(ppo) <- setNames(
+   c(coef(ppo),5,6,7),c(names(coef(ppo)),
+                        sprintf("xsp[rw1]"),sprintf("xsp[rw2]"),"xsh"))},err)
[1] TRUE
> test({coef(ppo) <- setNames(
+   c(coef(ppo)[-c(1:2)],5,6),c(names(coef(ppo)[-c(1:2)]),
+                               sprintf("xsp[rw1]"),sprintf("xsp[rw2]")))},err)
[1] TRUE
> wQuotes("Error : in ''coef<-'': part of ''coef(object)'' is not specified ",
+                "in ''value''.\n") -> err
> test(coef(ppo) <- coef(ppo)[-c(1:2)],err)
[1] TRUE
> test(coef(ppo) <- ppo@pParams$shared,err)
[1] TRUE
> #err <- wQuotes(
> #  "Error : in 'coef<-': invalid class ",dQuote("panelPomp")," object: All ",
> #  "parameters in the pomp objects of 'unit.objects' slot must be in 'pParams'",
> #  "and viceversa (validity check)\n")
> ## test length,panelPomp-method
> test(length(ppo),2L)
[1] TRUE
> ## test names,panelPomp-method
> test(names(ppo),c("rw1","rw2"))
[1] TRUE
> ## test pparams,panelPomp-method
> test(pparams(ppo),ppo@pParams)
[1] TRUE
> ## test pParams function
> ## all sh
> test(pParams(coef(ppo)[grep("^.+\\[.+?\\]$",names(coef(ppo)),perl=TRUE,
+                             value=TRUE,invert=TRUE)]),
+      list(shared=ppo@pParams$shared,specific=array(numeric(0),dim=c(0,0))))
[1] TRUE
> ## all sp
> test(list(shared=numeric(0),specific=ppo@pParams$specific),
+      pParams(coef(ppo)[grep("^.+\\[.+?\\]$",names(coef(ppo)),perl=TRUE,
+                             value=TRUE)]))
[1] TRUE
> ## both sh & sp
> test(pParams(coef(ppo)),ppo@pParams)
[1] TRUE
> ## test unitobjects,panelPomp-method
> test(unitobjects(ppo),ppo@unit.objects)
[1] TRUE
> test(unitobjects(ppo,unit="rw1"),ppo@unit.objects[["rw1"]])
[1] TRUE
> ## test window,panelPomp-method
> test(length(window(ppo,U=1))==1L)
[1] TRUE
> test(setNames(c(1,2,0),c("sigmaX","sigmaY",sprintf("X.0[rw1]"))),
+      coef(window(ppo,U=1)))
[1] TRUE
> test(lapply(as(window(ppo,start=2),"list"),time),list(rw1=c(2,3,4),rw2=c(2,3,4)))
[1] TRUE
> test(lapply(as(window(ppo,end=2),"list"),time),list(rw1=c(1,2),rw2=c(1,2)))
[1] TRUE
> test(length(window(ppo,U=1,start=1,end=2)),1L) 
[1] TRUE
> test(lapply(as(window(ppo,U=1,start=1,end=2),"list"),time),list(rw1=c(1,2)))
[1] TRUE
> 
> ## check whether all tests passed
> all(get(eval(formals(test))$all))
[1] TRUE
> if (!all(get(eval(formals(test))$all))) stop("Not all tests passed!")
> 
